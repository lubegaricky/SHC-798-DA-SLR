---
title: "SHC 798 Assignment 2, 2025"
author: "Richard Lubega"
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

# SHC 798 Assignment 2, 2025

## Analysis of Variance (ANOVA)

### Question 4: # Timber bending stiffness results

```{r, Part-1-a}
pacman::p_load(tidymodels)

# Getting started with the dataset in timber.csv :
timber <- read.csv(file.choose(), header = TRUE, na.strings = c("NA"))
# timber
head(timber)
str(timber)
## Convert species column to a factor
timber$species <- factor(timber$species)
## Check levels
levels(timber$species)

## Visualize data
stripchart(stiffness ~ species, data = timber, pch = 1, vertical = TRUE)

# Summary statistics by species
summary_stats <- timber %>%
  group_by(species) %>%
  summarise(
    Mean = mean(stiffness),
    SD = sd(stiffness),
    Median = median(stiffness),
    IQR = IQR(stiffness),
    Q1 = quantile(stiffness, 0.25),
    Q3 = quantile(stiffness, 0.75),
    Min = min(stiffness),
    Max = max(stiffness)
  )

# Identify outliers using IQR method
outliers <- timber %>%
  group_by(species) %>%
  mutate(
    Q1 = quantile(stiffness, 0.25),
    Q3 = quantile(stiffness, 0.75),
    IQR = Q3 - Q1,
    Lower_Bound = Q1 - 1.5 * IQR,
    Upper_Bound = Q3 + 1.5 * IQR,
    Outlier = stiffness < Lower_Bound | stiffness > Upper_Bound
  ) %>%
  filter(Outlier) %>%
  select(species, stiffness)

# Print summary statistics and outliers
print("Summary Statistics:")
print(summary_stats)
print("Outliers:")
print(outliers)

# Part a): # Box Plots
boxplot(stiffness ~ species,
        data = timber,
        main = "Bending Stiffness by Timber Species",
        xlab = "Timber Species",
        ylab = "Bending Stiffness (kN路m虏)",
        col = c("lightblue", "lightgreen", "lightpink"),
        border = "black")
#Adding means as points
means <- tapply(timber$stiffness, timber$species, mean)
points(1:3, means, pch = 19, col = "red")
# Annotate outliers on the plot
# text(x = bp$group, y = bp$out, labels = bp$out, pos = 3, cex = 0.7, col = "darkblue")
```

#### **Commenting on Variability and Outliers**

*Variability*: Standard Deviation (SD): Gum has the highest variability (SD = 641.0 kN路m虏), followed by cedar (SD = 572.8 kN路m虏), and pine has the lowest (SD = 552.6 kN路m虏). This suggests that gum's stiffness values are more spread out compared to pine and cedar.

*Interquartile Range (IQR)*: Pine has the highest IQR (696.8 kN路m虏), indicating a slightly wider spread of the middle 50% of stiffness values compared to gum (673.8 kN路m虏) and cedar (659.1 kN路m虏). However, the differences in IQR are small, suggesting comparable spread in the central data across species.

*Range (Max - Min)*: Gum shows the largest range (11124.5 - 8314.9 = 2809.6 kN路m虏), followed by cedar (10074.9 - 8220.3 = 1854.6 kN路m虏), and pine (8982.9 - 6999.2 = 1983.7 kN路m虏). This reinforces that gum has the most extreme values.

*Central Tendency*: Gum has the highest median stiffness (9425.3 kN路m虏), followed by cedar (9387.7 kN路m虏), and pine (8139.2 kN路m虏). This indicates that gum and cedar generally have higher bending stiffness than pine.

In short;

**Variability**: Gum exhibits the highest variability in bending stiffness, as seen in its larger SD and range, suggesting less consistency in its mechanical properties compared to pine and cedar. Cedar and pine have similar variability, but pines stiffness values are generally lower.

**Outliers**: Pine has one low outlier, indicating a single timber sample with unusually low stiffness, possibly due to defects or testing conditions. Gum has both a high and a low outlier, suggesting it can exhibit extreme stiffness values (both stronger and weaker), which may reflect natural variability or quality differences in the samples. Cedars lack of outliers suggests greater consistency in its stiffness properties.

**Practical Implications**: If consistency is desired, cedar may be preferable due to its lack of outliers and moderate variability. Gums higher median stiffness is appealing for strength, but its outliers and variability suggest a need for quality control. Pines lower stiffness and single outlier may indicate its less suitable for applications requiring high or consistent stiffness.

```{r, Part-1-b}
# Part b):# Fit a one-way ANOVA test
timber$species <- relevel(timber$species, ref = "gum")
options(contrasts = c("contr.sum", "contr.poly"))
# options(contrasts = c("contr.treatment", "contr.poly")) # used as default anyway

stiff <- aov(stiffness ~ species, data = timber)
summary(stiff) ## ANOVA table including F-test

## Extract coefficients
coef(stiff)       ## be careful with interpretation
dummy.coef(stiff) ## full coefficients, easier to interpret
```

### **Model Interpretation**

*Null hypothesis* (H): ~pine~ = ~gum~ = ~cedar~ (All species have the same mean bending stiffness)

*Alternative hypothesis* (H~A~): At least one species has a different mean stiffness.

**F-statistic**: 32.17; Large F-value indicates that between-species variability is much greater than within-species variability.

**p-value**: 4.45  10宦光;Extremely small (\< 0.001), so we reject H at all the conventional significance levels like 0.05 and 0.01.

**Conclusion**: There is **strong statistical evidence** that the mean bending stiffness differs significantly between timber species.

```{r, Part-1-c}
# Part c) # A pairwise two-sample t-tests (with multiple comparison correction)
# Perform pairwise t-tests with Bonferroni correction
tapply(timber$stiffness, timber$species, sd) # check for group SD
tapply(timber$stiffness, timber$species, var) # check for group var
pairwise_results <- pairwise.t.test(timber$stiffness, timber$species, 
                                    p.adjust.method = "bonferroni", 
                                    pool.sd = FALSE, # Welch's t-test (unequal variances)
                                    paired = FALSE,  # Independent samples
                                    conf.level = 0.95)

# Print the results
print("Pairwise t-test results with Bonferroni correction:")
print(pairwise_results)

```

### **Test Interpretation**

**Test method**: Welch-adjusted pairwise t-test because the groups have unequal variances. This adjusts the degrees of freedom for each pair according to Welchs formula.

*Null hypothesis* (H): ~pine~ = ~gum~ or ~pine~ = ~cedar~ or ~gum~ = ~cedar~ (mean bending stiffness is the same) and the *alternative hypothesis* (H~A~): Means differ. We reject H if p \< 0.05.

**Interpretation for each pair**


:   **pine vs gum**: p = 8.1  10烩 \< 0.05 (significant) implying that mean stiffness differs between pine and gum, hence gum is stiffer than pine (looking at raw data: gum = 9500 vs pine = 8100).

:   **pine vs cedar**: p = 6.0  10烩 \< 0.05 (significant) implying that mean stiffness differs between pine and cedar hence cedar is stiffer than pine (cedar = 9400).

:   **gum vs cedar**: p = 1 (not significant) implying that there is no evidence that gum and cedar differ in mean stiffness. Their stiffness values are roughly similar (gum = 9500, cedar = 9400).

Therefore, practically, pine is the softest whereas gum and cedar have *similar* higher stiffness.

```{r, Part-1-d}
# Part d) ## Residual Diagnostics
plot(stiff, which = 2)
plot(stiff, which = 1)

```

From the residual plots (TA), error variance is constant and error can be expected to be zero. Errors are i.i.d (from Q-Q plot). No autocorrelation.
